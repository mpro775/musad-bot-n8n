# Runbook: High p95 Latency

## الأعراض

- ارتفاع في p95 latency في Grafana.
- تنبيهات من Alertmanager تشير إلى `HighLatency`.
- شكاوى من المستخدمين تفيد ببطء في الخدمة.

## تشخيص

1.  **تحقق من لوحة مراقبة Grafana:** افتح لوحة مراقبة الأداء الرئيسية وابحث عن الارتباط بين ارتفاع زمن الاستجابة وأي من المقاييس التالية:
    *   `http_request_duration_seconds_bucket`: لتحديد المسارات (routes) التي تسبب البطء.
    *   `database_query_duration_seconds`: للتحقق من وجود استعلامات بطيئة في قاعدة البيانات.
    *   `cache_miss_total`: للتحقق من وجود نسبة عالية من cache misses.
2.  **فحص سجلات Loki:** استخدم Request ID من السجلات للبحث عن الطلبات البطيئة وتتبع مسارها عبر الخدمات.
3.  **تحليل الأداء:** استخدم أدوات تحليل الأداء (profiling) لتحديد الأجزاء البطيئة في الكود.

## حلول فورية

-   **إعادة تشغيل الخدمة:** قد تساعد إعادة تشغيل الخدمة في حل المشكلة مؤقتًا إذا كانت ناتجة عن تسرب في الذاكرة أو حالة غير متوقعة.

## حلول دائمة

-   **تحسين الكود:** قم بتحسين الكود المسبب للبطء.
-   **تحسين الاستعلامات:** قم بتحسين استعلامات قاعدة البيانات أو إضافة فهارس (indexes).
-   **استخدام الكاش:** قم بإضافة أو تحسين استخدام الكاش لتقليل زمن الوصول إلى البيانات.

## Postmortem

-   **تحليل السبب الجذري:** قم بتوثيق السبب الجذري للمشكلة.
-   **الإجراءات المتخذة:** وثق الإجراءات التي تم اتخاذها لحل المشكلة.
-   **الدروس المستفادة:** سجل الدروس المستفادة لمنع تكرار المشكلة في المستقبل.

